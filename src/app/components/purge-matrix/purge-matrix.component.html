<div class="purge-matrix-container">
  <div class="header">
    <h2>Purge Matrix</h2>
    <p class="subtitle">Extruder changed to</p>
  </div>

  @if (colors().length === 0) {
    <div class="no-data">
      <p>No filament colors defined. Please add some colors in the "Filament Colors" tab.</p>
    </div>
  } @else {
    <div class="matrix-wrapper">
      <table class="purge-matrix-table">
        <thead>
          <tr>
            <th class="from-label">From</th>
            @for (color of colors(); track color.id) {
              <th class="color-header">
                <div class="color-circle" [style.background-color]="color.color"></div>
                <span class="color-number">{{ $index + 1 }}</span>
              </th>
            }
          </tr>
        </thead>
        <tbody>
          @for (fromColor of colors(); track fromColor.id) {
            <tr>
              <td class="row-header">
                <div class="color-circle" [style.background-color]="fromColor.color"></div>
                <span class="color-number">{{ $index + 1 }}</span>
              </td>
              @for (toColor of colors(); track toColor.id) {
                <td class="purge-cell">
                  @if (fromColor.id === toColor.id) {
                    <div class="diagonal-cell"></div>
                  } @else {
                    <mat-form-field appearance="outline" class="purge-input">
                      <input 
                        matInput 
                        type="number" 
                        [value]="getPurgeVolume(fromColor.id, toColor.id)"
                        (input)="updatePurgeVolume(fromColor.id, toColor.id, $event)"
                        min="0"
                        max="999">
                    </mat-form-field>
                  }
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>

    <div class="footer">
      <div class="legend">
        <h3>Legend:</h3>
        <div class="legend-item">
          <div class="color-circle example" style="background-color: #FF6B35;"></div>
          <span class="color-number">1</span>
          <span class="legend-text">= Color 1 (corresponds to matrix row/column)</span>
        </div>
        <div class="legend-item">
          <div class="diagonal-cell example"></div>
          <span class="legend-text">= Same color (no purge needed)</span>
        </div>
      </div>
      <p class="units">(all values in mmÂ³)</p>
      <button mat-raised-button color="primary" (click)="setValuesFromConfiguration()">
        Set values from configuration
      </button>
    </div>
  }
</div>
